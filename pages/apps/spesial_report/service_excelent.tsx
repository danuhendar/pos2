'use client'
import FormServiceExcellent from "@/components/spesial_report/FormServiceExcellent";
import Link from "next/link";
import { useEffect, useState } from "react";
import { useTranslation } from "react-i18next";
import { GetCommandPowershell, GetToken } from "@/lib/global";
import themeConfig from "@/theme.config";

const Service_Excelent=() => {
    const [Token,setToken] = useState('')
    const { t, i18n } = useTranslation()
    
    useEffect(() => {
        var key = GetToken()
        setToken(key)
        
    });
    return(
        <>
            <div className="mb-5">
            <ul className="flex space-x-2 rtl:space-x-reverse">
                <li>
                    {t('Report')}
                </li>
                <Link href="/apps/spesial_report/service_excellent" className="text-primary hover:underline">    
                <li className="before:content-['/'] ltr:before:mr-2 rtl:before:ml-2">
                    <span>Service Excellent</span>
                </li>
                </Link>
            </ul>
            </div>
            <FormServiceExcellent 
                        url={`ws://${themeConfig.host}:${themeConfig.port_listener}/sock/v1/ReportFromListener?Token=${Token}`}
                        //-- using se.dll --//
                        command={GetCommandPowershell("$pl='C:\\IDMCommandListeners\\';$vs= $PSVersionTable.PSVersion.Major;if($vs -eq 2){Write-Host '2';}else{$prodsedll='1.1.6.0';$res_ok='SYSTEM MALFUNCTION|CRC SALAH|TIDAK TERIMA RESPONSE DARI HOST|OK|00BANK|MELAMPAUI LIMIT|SALDO TIDAK|SALAH PIN|AKTIVASI ULANG|DO NOT HONOR|SUCCESS|LOCAL|TAP';$res_offline='TIME OUT|aborted|TIDAK TERIMA RESPONSE DARI EDC|DITOLAK|ERROR HOST|The specified|RESPONSE DARI EDC|The semaphore|Given|THE DEVICE|A device|Access|ERROR|THE PORT';$vlist=Get-Content -Path 'C:\\IDMCommandListeners\\version.txt';$rvlist=$vlist.Replace('.','');if($rvlist -lt 424){Write-Host 'NOK Versi IDMCommandListeners'}else{$sts='';$gs=Get-ChildItem -Path 'env:'|Where-Object{$_.Name -like 'station'};foreach($vr in $gs){if($vr.Value.substring(0,1) -eq 0){$sts=$vr.Value.substring(1,1)}else{$sts=$vr.Value}};$stf=$gs.Value;$us='edp';$pss='cUm4l!h4t@datA';$dF=''+$pl+'SE.dll';add-type -path $dF;if(Test-Path $dF){$vdll=(Get-Item C:\\IDMCommandListeners\\SE.dll).VersionInfo|Select-Object ProductVersion|Format-Table -HideTableHeader|Out-String;if([int]$vdll.Trim().Replace('.','') -lt [int]$prodsedll.Trim().Replace('.','')){Write-Host 'Versi SE.dll Belum Update!'}elseif($vdll.Trim() -eq $prodsedll){$hwi=[SE.Class1]::EHW();$ek='';if($stf -eq 'I1'){$ek='';}else{try{$ek=[SE.Class1]::MysqlForPosnet('se',$us,$pss)}catch{$ek=$_.Exception.Message}}$edc='';try{$edc=[SE.Class1]::EDC(300,$us,$pss,'3306');}catch{$edc=$_.Exception.Message}function getOSCrash(){$os_crash=0;$hard_reset=0;$unexpected=0;$startDate=(Get-Date).AddDays(-3);[xml]$Xml='';Get-WinEvent -FilterHashtable @{LogName='System'; Id=41}|Where-Object{$_.TimeCreated -gt $startDate}|ForEach-Object{$data=$_.ToXml();$Xml=$data;$resBugcheckCode=$Xml.Event.EventData.Data|Where-Object{$_.Name -eq 'BugcheckCode'}|ft -HideTableHeaders -Wrap|Out-String;if($resBugcheckCode.ToString().Trim() -eq 'BugcheckCode 0' -Or $resBugcheckCode.ToString().Trim() -eq ''){}else{if($_.TimeCreated -ge (Get-Date).AddDays(-1)){$os_crash++;}else{};}};$hasil=-join('',$os_crash,'|');return  $hasil;}$bsod=getOSCrash;$acl = Get-Acl -Path 'D:\\Backoff';$racl=$acl.Access | Where-Object {$_.IdentityReference -like '*everyone*'} |Select-Object FileSystemRights|ConvertTo-Csv -NotypeInformation|Select -Skip 1|Out-String;$hs=-join($hwi,'',$edc,'~',$ek,'~',$bsod.Replace('|',''),'~',$racl);$hs;}else{$hwi=[SE.Class1]::EHW();$ek='';if($stf -eq 'I1'){$ek='';}else{try{$ek=[SE.Class1]::MysqlForPosnet('se',$us,$pss);}catch{$ek=$_.Message.Exception}}$edc='';try{$edc=[SE.Class1]::EDC(300,$us,$pss,'3306',$res_ok,$res_offline);}catch{$edc=$_.Exception.Message}$bsod=[SE.Class1]::GetBSOD();$racl=[SE.Class1]::GetACL();$hs=-join($hwi,'',$edc,'~',$ek,'~',$bsod,'~',$racl);$hs;}}else{Write-Host 'NOK SE.dll';}}}",120)}
                        command_gagal={GetCommandPowershell("$scriptBlock={$pl='C:\\IDMCommandListeners\\';$vs= $PSVersionTable.PSVersion.Major;if($vs -eq 2){Write-Host '2';}else{$prodsedll='1.1.6.0';$res_ok='SYSTEM MALFUNCTION|CRC SALAH|TIDAK TERIMA RESPONSE DARI HOST|OK|00BANK|MELAMPAUI LIMIT|SALDO TIDAK|SALAH PIN|AKTIVASI ULANG|DO NOT HONOR|SUCCESS|LOCAL|TAP';$res_offline='TIME OUT|aborted|TIDAK TERIMA RESPONSE DARI EDC|DITOLAK|ERROR HOST|The specified|RESPONSE DARI EDC|The semaphore|Given|THE DEVICE|A device|Access|ERROR|THE PORT';$vlist=Get-Content -Path 'C:\\IDMCommandListeners\\version.txt';$rvlist=$vlist.Replace('.','');if($rvlist -lt 424){Write-Host 'NOK Versi IDMCommandListeners'}else{$sts='';$gs=Get-ChildItem -Path 'env:'|Where-Object{$_.Name -like 'station'};foreach($vr in $gs){if($vr.Value.substring(0,1) -eq 0){$sts=$vr.Value.substring(1,1)}else{$sts=$vr.Value}};$stf=$gs.Value;$us='edp';$pss='cUm4l!h4t@datA';$dF=''+$pl+'SE.dll';add-type -path $dF;if(Test-Path $dF){$vdll=(Get-Item C:\\IDMCommandListeners\\SE.dll).VersionInfo|Select-Object ProductVersion|Format-Table -HideTableHeader|Out-String;if([int]$vdll.Trim().Replace('.','') -lt [int]$prodsedll.Trim().Replace('.','')){Write-Host 'Versi SE.dll Belum Update!'}elseif($vdll.Trim() -eq $prodsedll){$hwi=[SE.Class1]::EHW();$ek='';if($stf -eq 'I1'){$ek='';}else{$ek='TIDAK PERLU'}$edc='';try{$edc=[SE.Class1]::EDC(300,$us,$pss,'3306');}catch{$edc=$_.Exception.Message}function getOSCrash(){$os_crash=0;$hard_reset=0;$unexpected=0;$startDate=(Get-Date).AddDays(-3);[xml]$Xml='';Get-WinEvent -FilterHashtable @{LogName='System'; Id=41}|Where-Object{$_.TimeCreated -gt $startDate}|ForEach-Object{$data=$_.ToXml();$Xml=$data;$resBugcheckCode=$Xml.Event.EventData.Data|Where-Object{$_.Name -eq 'BugcheckCode'}|ft -HideTableHeaders -Wrap|Out-String;if($resBugcheckCode.ToString().Trim() -eq 'BugcheckCode 0' -Or $resBugcheckCode.ToString().Trim() -eq ''){}else{if($_.TimeCreated -ge (Get-Date).AddDays(-1)){$os_crash++;}else{};}};$hasil=-join('',$os_crash,'|');return  $hasil;}$bsod=getOSCrash;$acl = Get-Acl -Path 'D:\\Backoff';$racl=$acl.Access | Where-Object {$_.IdentityReference -like '*everyone*'} |Select-Object FileSystemRights|ConvertTo-Csv -NotypeInformation|Select -Skip 1|Out-String;$hs=-join($hwi,'',$edc,'~',$ek,'~',$bsod.Replace('|',''),'~',$racl);$hs;}else{$hwi=[SE.Class1]::EHW();$ek='';if($stf -eq 'I1'){$ek='';}else{$ek='TIDAK PERLU'}$edc='';try{$edc=[SE.Class1]::EDC(300,$us,$pss,'3306',$res_ok,$res_offline);}catch{$edc=$_.Exception.Message}$bsod=[SE.Class1]::GetBSOD();$racl=[SE.Class1]::GetACL();$hs=-join($hwi,'',$edc,'~',$ek,'~',$bsod,'~',$racl);$hs;}}else{Write-Host 'NOK SE.dll';}}}};$timeout=20;$job = Start-Job -ScriptBlock $scriptBlock;if (Wait-Job -Job $job -Timeout $timeout){$result=Receive-Job -Job $job;Write-Host $result;}else{Stop-Job -Job $job;Remove-Job -Job $job;Write-Host ('Job timed out after',$timeout,'seconds');};",120)}
                        //command={"%systemroot%\\System32\\WindowsPowerShell\\v1.0\\powershell.exe \"$scriptBlock={$pl='C:\\IDMCommandListeners\\';$vs= $PSVersionTable.PSVersion.Major;if($vs -eq 2){Write-Host '2';}else{$prodsedll='1.1.6.0';$res_ok='SYSTEM MALFUNCTION|CRC SALAH|TIDAK TERIMA RESPONSE DARI HOST|OK|00BANK|MELAMPAUI LIMIT|SALDO TIDAK|SALAH PIN|AKTIVASI ULANG|DO NOT HONOR|SUCCESS|LOCAL|TAP';$res_offline='TIME OUT|aborted|TIDAK TERIMA RESPONSE DARI EDC|DITOLAK|ERROR HOST|The specified|RESPONSE DARI EDC|The semaphore|Given|THE DEVICE|A device|Access|ERROR|THE PORT';$vlist=Get-Content -Path 'C:\\IDMCommandListeners\\version.txt';$rvlist=$vlist.Replace('.','');if($rvlist -lt 424){Write-Host 'NOK Versi IDMCommandListeners'}else{$sts='';$gs=Get-ChildItem -Path 'env:'|Where-Object{$_.Name -like 'station'};foreach($vr in $gs){if($vr.Value.substring(0,1) -eq 0){$sts=$vr.Value.substring(1,1)}else{$sts=$vr.Value}};$stf=$gs.Value;$us='edp';$pss='cUm4l!h4t@datA';$dF=''+$pl+'SE.dll';add-type -path $dF;if(Test-Path $dF){$vdll=(Get-Item C:\\IDMCommandListeners\\SE.dll).VersionInfo|Select-Object ProductVersion|Format-Table -HideTableHeader|Out-String;if([int]$vdll.Trim().Replace('.','') -lt [int]$prodsedll.Trim().Replace('.','')){Write-Host 'Versi SE.dll Belum Update!'}elseif($vdll.Trim() -eq $prodsedll){$hwi=[SE.Class1]::EHW();$ek='';if($stf -eq 'I1'){$ek='';}else{try{$ek=[SE.Class1]::MysqlForPosnet('se',$us,$pss)}catch{$ek=$_.Exception.Message}}$edc='';try{$edc=[SE.Class1]::EDC(300,$us,$pss,'3306');}catch{$edc=$_.Exception.Message}function getOSCrash(){$os_crash=0;$hard_reset=0;$unexpected=0;$startDate=(Get-Date).AddDays(-3);[xml]$Xml='';Get-WinEvent -FilterHashtable @{LogName='System'; Id=41}|Where-Object{$_.TimeCreated -gt $startDate}|ForEach-Object{$data=$_.ToXml();$Xml=$data;$resBugcheckCode=$Xml.Event.EventData.Data|Where-Object{$_.Name -eq 'BugcheckCode'}|ft -HideTableHeaders -Wrap|Out-String;if($resBugcheckCode.ToString().Trim() -eq 'BugcheckCode 0' -Or $resBugcheckCode.ToString().Trim() -eq ''){}else{if($_.TimeCreated -ge (Get-Date).AddDays(-1)){$os_crash++;}else{};}};$hasil=-join('',$os_crash,'|');return  $hasil;}$bsod=getOSCrash;$acl = Get-Acl -Path 'D:\\Backoff';$racl=$acl.Access | Where-Object {$_.IdentityReference -like '*everyone*'} |Select-Object FileSystemRights|ConvertTo-Csv -NotypeInformation|Select -Skip 1|Out-String;$hs=-join($hwi,'',$edc,'~',$ek,'~',$bsod.Replace('|',''),'~',$racl);$hs;}else{$hwi=[SE.Class1]::EHW();$ek='';if($stf -eq 'I1'){$ek='';}else{try{$ek=[SE.Class1]::MysqlForPosnet('se',$us,$pss);}catch{$ek=$_.Message.Exception}}$edc='';try{$edc=[SE.Class1]::EDC(300,$us,$pss,'3306',$res_ok,$res_offline);}catch{$edc=$_.Exception.Message}$bsod=[SE.Class1]::GetBSOD();$racl=[SE.Class1]::GetACL();$hs=-join($hwi,'',$edc,'~',$ek,'~',$bsod,'~',$racl);$hs;}}else{Write-Host 'NOK SE.dll';}}}};$timeout=40;$job = Start-Job -ScriptBlock $scriptBlock;if (Wait-Job -Job $job -Timeout $timeout){$result=Receive-Job -Job $job;Write-Host $result;}else{Stop-Job -Job $job;Remove-Job -Job $job;Write-Host ('Job timed out after',$timeout,'seconds');};exit;\""}
                        //-- get cpu usage total exists --//
                        //command={"%systemroot%\\System32\\WindowsPowerShell\\v1.0\\powershell.exe \"$pl='C:\\IDMCommandListeners\\';$vs= $PSVersionTable.PSVersion.Major;if($vs -eq 2){Write-Host '2';}else{$sts='';$gs=Get-ChildItem -Path 'env:'|Where-Object{$_.Name -like 'station'};foreach($vr in $gs){if($vr.Value.substring(0,1) -eq 0){$sts=$vr.Value.substring(1,1)}else{$sts=$vr.Value}};$stf=$gs.Value;$us='edp';$pss='cUm4l!h4t@datA';$dF=''+$pl+'SE.dll';add-type -path $dF;if(Test-Path $dF){$hwi=[SE.Class1]::EHW();$edc=[SE.Class1]::EDC(300,$us,$pss,'3306');$ek='';if($stf -eq 'I1'){$ek='';}else{$ek=[SE.Class1]::MysqlForPosnet('se',$us,$pss);}$hs=-join($hwi,'',$edc,'~',$ek);$hs;}else{$er='TIME OUT|aborted|TIDAK TERIMA RESPONSE DARI EDC|DITOLAK|ERROR HOST|The specified|RESPONSE DARI EDC|The semaphore|Given|THE DEVICE|A device|Access|ERROR|THE PORT';$vir='RESPONSE DARI HOST|CRC SALAH|HONOR|MALFUN';$ok=$vir+'|OK|00BANK|MELAMPAUI LIMIT|SALDO TIDAK|SALAH PIN|AKTIVASI ULANG';$li='C:\\Windows\\System32\\slmgr.vbs';$mr='MANDIRI';$r='Replace';$ifn='IFNULL';$d='DOCNO';$j='JENIS';$ry='RKEY';$cst='CONST';$lf='LEFT';$nw='NOW()';$y='YEAR';$k='RLIKE';$ct='CONCAT';$n='AND';$ks='response';$dlt='DESC LIMIT';$jdc='jenisedc';$T='SELECT';$w='WHERE';$f='FROM';$cv='CONVERT';$by='ORDER BY';$x='NOEDC';$rp='responsetime';$de='DATE(responsetime)';$td='heartbeat_edc';$lip='';$gp=cmd /r ipconfig|find 'IPv4 Address';$rk=$gp.Replace('IPv4 Address','').Replace('. ','').Replace(':','').Replace(' ','').Replace(' ',',');if($rk.Length -lt 5){for($v=0;$v -lt $rk.Length;$v++){$lip=''+$lip+','+$rk[$v]};$rlp='\\\"'+$lip.substring(1,$lip.Length-1).Replace(',' ,'\\\",\\\"')+'\\\"'}else{$rlp='\\\"'+$rk+'\\\"'}function get(){$d1=Get-WmiObject Win32_Battery;$ws=Get-WmiObject Win32_OperatingSystem;$os=$ws.Caption;$ar=$ws.OSArchitecture;$cfo=Get-WmiObject Win32_Processor;$cs=$($cfo.Name);$cTot=Get-WmiObject Win32_PerfFormattedData_PerfOS_Processor|Where-Object{$_.Name -eq '_Total'};$cpr=$cTot.PercentProcessorTime;$pM=($ws.TotalVisibleMemorySize-$ws.FreePhysicalMemory)/$ws.TotalVisibleMemorySize*100;$pn=Get-WmiObject Win32_PhysicalMemory;$tme=($pn|Measure-Object Capacity -Sum).Sum/1GB;$tps=$ws.TotalVisibleMemorySize/1MB;$do=Get-WmiObject Win32_DiskDrive;foreach($disk in $do){$hml=$($disk.Model)};$cap=0;$use=0;$fre=0;$dvs=Get-WmiObject Win32_LogicalDisk;foreach($dr in $dvs){$cpy=$dr.Size;$frSp=$dr.FreeSpace;$usp=$cpy-$frSp;$cap+=$cpy;$use+=$usp;$fre+=$frSp};$tcp=$cap/1GB;$cf=Get-PhysicalDisk;$fk='';if(-not([string]::IsNullOrEmpty($cf.HealthStatus))){$fk=$cf.HealthStatus}else{$f=cmd /r wmic diskdrive get status|Out-String;$fk=$f}$rst=powercfg /q SCHEME_BALANCED SUB_BATTERY;$rss=$rst-split '`n';$lBACI=$null;$cBAAC=$null;for($i=0;$i -lt $rss.Length;$i++){$line=$rss[$i];$lDC='';if($line -like '*Power Setting GUID: d8742dcb-3e6a-4b3c-b3fe-374623cdcf06*'){if($rss[$i+1].tostring() -like '*Alias*'){$line=$rss[$i+10];$lDC=$rss[$i+11]}else{$line=$rss[$i+9];$lDC=$rss[$i+10]};$lBACI=$line.Trim().Split(':')[1].Trim();$BDC=$lDC.Trim().Split(':')[1].Trim()};if($line -like'*Power Setting GUID: 637ea02f-bbcb-4015-8e2c-a1c7b9c0b546*'){if($rss[$i+1].tostring() -like '*Alias*'){$line=$rss[$i+10];$lDC=$rss[$i+11]}else{$line=$rss[$i+9];$lDC=$rss[$i+10]};$BAC=$line.Trim().Split(':')[1].Trim();$cBIdx=$lDC.Trim().Split(':')[1].Trim()}};function Name($idx){if($idx-eq'0x00000000'){return 'Do nothing'}elseif($idx -eq'0x00000001'){return 'Sleep'}elseif($idx -eq'0x00000002'){return 'Hibernate'}elseif($idx -eq'0x00000003'){return 'Shut down'}else{return 'Unknown'}};$lB1=$(Name $lBACI);$lB2=$(Name $BDC);$cB1=$(Name $BAC);$cB2=$(Name $cBIdx);$hb1=$false;$hb2=$false;if($lB1 -eq'Hibernate' -or $lB2 -eq'Hibernate'){$hb1=$true};if($cB1 -eq'Hibernate' -or $cB2 -eq'Hibernate'){$hb2=$true};if($hb1 -eq $true -and $hb2 -eq $true){$Hib='OK'}else{$Hib='NOK'};$na=Get-WmiObject Win32_NetworkAdapter|Where-Object{$_.AdapterType -eq 'Ethernet 802.3' -and $_.NetConnectionStatus -eq 2};foreach($adr in $na){$sM=$adr.Speed/1e6;$l=''+$sM+' MB/s'};$rup='';if($d1){$sS=$d1.Status;$bs=$d1.BatteryStatus;$br=$d1.EstimatedChargeRemaining;$rup=$sS+' '+$bs+' '+$br+'%'}else{$rup='NOK'};$lB=[System.Management.ManagementDateTimeConverter]::ToDateTime($ws.LastBootUpTime);$upt=(Get-Date)-$lB;$sUp=''+$upt.Days+' hari '+$upt.Hours+' jam '+$upt.Minutes+' menit';$An=(cscript /Nologo $li /xpr)|Out-String;$lc=(Get-WmiObject -query 'select * FROM SoftwareLicensingService').OA3xOriginalProductKey;$l2=$dFP=$pl+'OS_KeyDLL.dll';if(Test-Path $dFP){add-type -path $dFP;$dID=[OS_KeyDLL.OS_KeyGet]::GetRegistryDigitalProductId();$l2=[OS_KeyDLL.OS_KeyGet]::WInnKeyFinder($dID)}else{$l2='NOK Dll'}$pK=$lc+':'+$l2;$dll=$pl+'LibreHardwareMonitorLib.dll';Add-Type -LiteralPath $dll;$m=[LibreHardwareMonitor.Hardware.Computer]::new();$m.IsCPUEnabled=$true;$m.Open();foreach($sr in $m.Hardware.Sensors){if($sr.SensorType -eq'Temperature' -and $sr.Name -eq'CPU Package'){$em=$sr.Value;break}}$m.Close();$bt=Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Diagnostics-Performance/Operational';Id=100,108,110}-MaxEvents 1|ForEach-Object{$eventXml=([xml]$_.ToXml()).Event;[math]::round(([int64]($eventXml.EventData.Data|Where-Object{$_.Name -eq 'BootTime'}).InnerXml)/1000/60,2)};$is=cmd /c systeminfo | find \\\"Install Date:\\\";$hl=''+$os+'~'+$ar+'~'+$cs+'~'+$cpr+'~'+$pM+'~'+$tme+'~'+$tps+'~'+$hml+'~'+$tcp+'~'+$use/1GB+'~'+$fre/1GB+'~'+$fk.Trim()+'~'+$cf.MediaType+'~'+$Hib+'~'+$rup+'~'+$d1.DeviceID+'~'+$l+'~'+$sUp+'~'+$An.Trim()+'~'+$pK+'~'+$is+'~'+$em+'~'+$bt+'~'+$rlp+'~';return $hl}$al=get;function G($stf){[void][system.reflection.Assembly]::LoadFrom(-join($pl,'MySql.Data.DLL'));$ipsd=-join('SUBSTRING_INDEX(REPLACE(IP_SENDER,\\\"fe80::5efe:\\\",\\\"\\\"),\\\"%\\\",1) IN(',$rlp,')');$h1='';$h2='';$rc=-join('recid=','\\\"',$stf.substring(1,1),'\\\"',' LIMIT 1');$rPh='HKCU:\\Software\\INDOMARET\\POS.NET\\Database';$vN='Server';$rgV=Get-ItemProperty -Path $rPh -Name $vN -ErrorAction Stop;$srv=$rgV.$vN;$Cn=New-Object -TypeName MySql.Data.MySqlClient.MySqlConnection;$Cn.ConnectionString=\"\\\"SERVER=$srv;DATABASE='pos';UID=$us;PWD=$pss\"\\\";$Cn.Open();$cm=New-Object MySql.Data.MySqlClient.MySqlCommand;$at=New-Object MySql.Data.MySqlClient.MySqlDataAdapter;$ds=New-Object System.Data.DataSet;$cm.Connection=$Cn;$cm.CommandText=\"\\\"$T $cv($ct($ifn(l.BCA,'$x'),'~',$ifn(l.MDR,'$x') ),CHAR)EDC $f($T($T $ct(v.BON,';',v.BOFF,';',$ifn(v.BST,'$x'),';',($T $ct($ry,':',$j,'(',$d,')') $f $cst $w $ry='NEB' LIMIT 1),'|',$ifn(($T $ct($ry,':',$d,' ',$j) $f $cst $w $ry='PC1' $n $rc),'-'),'|',$ifn(($T $ct($ry,':',$j) $f $cst $w $ry='PCO' $n $rc),'-'),'|',($T $ct($ry,':',a.DESC,' COM',$d) $f $cst a $w $ry='E01' $n $rc))BCA $f($T($T count(*)$f $td $w $jdc $k'BCA' $n ($ipsd) $n $de=($T MAX($de) $f $td $w $jdc $k'BCA' $n ($ipsd) $n $y($rp)=$y($nw)) $n $ks $k '$ok')BON,($T count(*)$f $td $w $jdc $k'BCA' $n ($ipsd) $n $de=($T MAX($de) $f $td $w $jdc $k'BCA' $n ($ipsd) $n $y($rp)=$y($nw)) $n $ks $k'$er')BOFF,($T $cv($ct(IF($ks $k '$ok','ONLINE','OFFLINE'),'-',$rp,IF($ks $k '$ok',IF($ks $k '$vir',$ct('-','(ACT VIRTUAL)',$ks),''),$ct('-',$ks))),CHAR) $f($T $ks,$rp $f $td $w $jdc $k'bca' $n ($ipsd) $n $y($rp)=$y($nw) $by $rp $dlt 0,1)a)BST)v)BCA,($T $ct(v.MON,';',v.MOFF,';',$ifn(v.MST,'$x'),';',($T $ct($ry,':',$j,'(',$d,')') $f $cst $w $ry ='NEM' LIMIT 1),'|',$ifn(($T $ct($ry,':',$d,'-',$j) $f $cst $w $ry='PC2' $n $rc),'-'),'|',$ifn(($T $ct($ry,':',$j) $f $cst $w $ry='PCO' $n $rc),'-'),'|',($T $cv($ct($ry,':',a.DESC,' COM',$d),CHAR) $f $cst a $w $ry='E02' $n $rc))MDR $f($T($T count(*)$f $td $w $jdc $k'$mr'$n ($ipsd) $n $de=($T MAX($de) $f $td $w $jdc $k'$mr' $n ($ipsd) $n $y($rp)=$y($nw)) $n $ks $k '$ok')MON,($T count(*)$f $td $w $jdc $k'$mr' $n ($ipsd) $n $de=($T MAX($de) $f $td $w $jdc $k'$mr' $n ($ipsd) $n $y($rp)=$y($nw))$n $ks $k '$er')MOFF,($T $cv($ct(IF($ks $k'$ok','ONLINE','OFFLINE'),'-',$rp,IF($ks $k '$ok',IF($ks $k '$vir',$ct('-','(ACT VIRTUAL)',$ks),''),$ct('-', $ks))),CHAR)$f ($T $ks,$rp $f $td $w $jdc $k'$mr' $n ($ipsd) $n $y($rp)=$y($nw) $by $rp $dlt 0,1)b)MST)v)MDR) l\"\\\";$at.SelectCommand=$cm;$Nm=$at.Fill($ds,'data');foreach($Dts in $ds.tables[0]){$h1=$Dts.EDC}$Cn.Close();$rh=$x+'|'+$x;if($h1.Length -gt 1){$h2=$h1}else{$h2=$rh}return $h2}$ed=G($stf);$al+''+$ed+'~'+$ek;}}\""}
                        //command={"%systemroot%\\System32\\WindowsPowerShell\\v1.0\\powershell.exe \"$pls='C:\\IDMCommandListeners\\';$vs= $PSVersionTable.PSVersion.Major;if($vs.Equals(2)){Write-Host '2';}else{$dF=''+$pls+'SE.dll';if(Test-Path $dF){$ef=-join($pls,'SE.dll');add-type -path $ef;$hwi=[SE.Class1]::EHW();$edc=[SE.Class1]::EDC(300);$hs=-join($hwi,'',$edc);$hs;}else{$er='TIME OUT|aborted|TIDAK TERIMA RESPONSE DARI EDC|DITOLAK|ERROR HOST|The specified|RESPONSE DARI EDC|The semaphore|Given|THE DEVICE|A device|Access|ERROR|THE PORT';$ok='MALFUN|CRC SALAH|TIDAK TERIMA RESPONSE DARI HOST|OK|00BANK|MELAMPAUI LIMIT|SALDO TIDAK|SALAH PIN|AKTIVASI ULANG|HONOR';$vir='RESPONSE DARI HOST|CRC SALAH|HONOR|MALFUNC';$li='C:\\Windows\\System32\\slmgr.vbs';$mr='MANDIRI';$r='Replace';$ifn='IFNULL';$d='DOCNO';$j='JENIS';$ry='RKEY';$cst='CONST';$lf='LEFT';$nw='NOW()';$y='YEAR';$k='RLIKE';$ct='CONCAT';$n='AND';$ks='response';$dlt='DESC LIMIT';$jdc='jenisedc';$T='SELECT';$w='WHERE';$f='FROM';$cv='CONVERT';$by='ORDER BY';$x='NOEDC';$rp='responsetime';$de='DATE(responsetime)';$tdc='heartbeat_edc';$sts='';$gs=Get-ChildItem -Path 'env:'|Where-Object{$_.Name -like 'station'};foreach($vr in $gs){if($vr.Value.substring(0,1) -eq 0){$sts=$vr.Value.substring(1,1)}else{$sts=$vr.Value}};$stf=$gs.Value;$lip='';$gp=cmd /r ipconfig|find 'IPv4 Address';$rk=$gp.Replace('IPv4 Address','').Replace('. ','').Replace(':','').Replace(' ','').Replace(' ',',');if($rk.Length -lt 5){for($v=0;$v -lt $rk.Length;$v++){$lip=''+$lip+','+$rk[$v]};$rlp='\\\"'+$lip.substring(1,$lip.Length-1).Replace(',' ,'\\\",\\\"')+'\\\"'}else{$rlp='\\\"'+$rk+'\\\"'}function get(){$d1=Get-WmiObject Win32_Battery;$ws=Get-WmiObject Win32_OperatingSystem;$os=$ws.Caption;$ar=$ws.OSArchitecture;$cfo=Get-WmiObject Win32_Processor;$cs=$($cfo.Name);$cTot=Get-WmiObject Win32_PerfFormattedData_PerfOS_Processor|Where-Object{$_.Name -eq '_Total'};$cpr=$cTot.PercentProcessorTime;$pM=($ws.TotalVisibleMemorySize-$ws.FreePhysicalMemory)/$ws.TotalVisibleMemorySize*100;$pn=Get-WmiObject Win32_PhysicalMemory;$tme=($pn|Measure-Object Capacity -Sum).Sum/1GB;$tps=$ws.TotalVisibleMemorySize/1MB;$do=Get-WmiObject Win32_DiskDrive;foreach($disk in $do){$hml=$($disk.Model)};$cap=0;$use=0;$fre=0;$dvs=Get-WmiObject Win32_LogicalDisk;foreach($dr in $dvs){$cpy=$dr.Size;$frSp=$dr.FreeSpace;$usp=$cpy-$frSp;$cap+=$cpy;$use+=$usp;$fre+=$frSp};$tcp=$cap/1GB;$cf=Get-PhysicalDisk;$fk='';if(-not([string]::IsNullOrEmpty($cf.HealthStatus))){$fk=$cf.HealthStatus}else{$f=cmd /r wmic diskdrive get status|Out-String;$fk=$f}$rst=powercfg /q SCHEME_BALANCED SUB_BATTERY;$rss=$rst-split '`n';$lBACI=$null;$cBAAC=$null;for($i=0;$i -lt $rss.Length;$i++){$line=$rss[$i];$lDC='';if($line -like '*Power Setting GUID: d8742dcb-3e6a-4b3c-b3fe-374623cdcf06*'){if($rss[$i+1].tostring() -like '*Alias*'){$line=$rss[$i+10];$lDC=$rss[$i+11]}else{$line=$rss[$i+9];$lDC=$rss[$i+10]};$lBACI=$line.Trim().Split(':')[1].Trim();$BDC=$lDC.Trim().Split(':')[1].Trim()};if($line -like'*Power Setting GUID: 637ea02f-bbcb-4015-8e2c-a1c7b9c0b546*'){if($rss[$i+1].tostring() -like '*Alias*'){$line=$rss[$i+10];$lDC=$rss[$i+11]}else{$line=$rss[$i+9];$lDC=$rss[$i+10]};$BAC=$line.Trim().Split(':')[1].Trim();$cBIdx=$lDC.Trim().Split(':')[1].Trim()}};function Name($idx){if($idx-eq'0x00000000'){return 'Do nothing'}elseif($idx -eq'0x00000001'){return 'Sleep'}elseif($idx -eq'0x00000002'){return 'Hibernate'}elseif($idx -eq'0x00000003'){return 'Shut down'}else{return 'Unknown'}};$lB1=$(Name $lBACI);$lB2=$(Name $BDC);$cB1=$(Name $BAC);$cB2=$(Name $cBIdx);$hb1=$false;$hb2=$false;if($lB1 -eq'Hibernate' -or $lB2 -eq'Hibernate'){$hb1=$true};if($cB1 -eq'Hibernate' -or $cB2 -eq'Hibernate'){$hb2=$true};if($hb1 -eq $true -and $hb2 -eq $true){$Hib='OK'}else{$Hib='NOK'};$nad=Get-WmiObject Win32_NetworkAdapter|Where-Object{$_.AdapterType -eq 'Ethernet 802.3' -and $_.NetConnectionStatus -eq 2};foreach($adr in $nad){$sM=$adr.Speed/1e6;$l=''+$sM+' MB/s'};$rup='';if($d1){$sS=$d1.Status;$bs=$d1.BatteryStatus;$bcr=$d1.EstimatedChargeRemaining;$rup=$sS+' '+$bs+' '+$bcr+'%'}else{$rup='NOK'};$lB=[System.Management.ManagementDateTimeConverter]::ToDateTime($ws.LastBootUpTime);$upt=(Get-Date)-$lB;$sUp=''+$upt.Days+' hari '+$upt.Hours+' jam '+$upt.Minutes+' menit';$An=(cscript /Nologo $li /xpr)|Out-String;$lc=(Get-WmiObject -query 'select * FROM SoftwareLicensingService').OA3xOriginalProductKey;$l2=$dFP=$pls+'OS_KeyDLL.dll';if(Test-Path $dFP){add-type -path $dFP;$dID=[OS_KeyDLL.OS_KeyGet]::GetRegistryDigitalProductId();$l2=[OS_KeyDLL.OS_KeyGet]::WInnKeyFinder($dID)}else{$l2='NOK Dll'}$pK=$lc+':'+$l2;$dll=$pls+'LibreHardwareMonitorLib.dll';Add-Type -LiteralPath $dll;$m=[LibreHardwareMonitor.Hardware.Computer]::new();$m.IsCPUEnabled=$true;$m.Open();foreach($sr in $m.Hardware.Sensors){if($sr.SensorType -eq'Temperature' -and $sr.Name -eq'CPU Package'){$em=$sr.Value;break}}$m.Close();$bt=Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Diagnostics-Performance/Operational';Id=100,108,110}-MaxEvents 1|ForEach-Object{$eventXml=([xml]$_.ToXml()).Event;[math]::round(([int64]($eventXml.EventData.Data|Where-Object{$_.Name -eq 'BootTime'}).InnerXml)/1000/60,2)};$ins=cmd /c systeminfo | find \\\"Install Date:\\\";$hl=''+$os+'~'+$ar+'~'+$cs+'~'+$cpr+'~'+$pM+'~'+$tme+'~'+$tps+'~'+$hml+'~'+$tcp+'~'+$use/1GB+'~'+$fre/1GB+'~'+$fk.Trim()+'~'+$cf.MediaType+'~'+$Hib+'~'+$rup+'~'+$d1.DeviceID+'~'+$l+'~'+$sUp+'~'+$An.Trim()+'~'+$pK+'~'+$ins+'~'+$em+'~'+$bt+'~'+$rlp+'~';return $hl}$al=get;function G($stf){[void][system.reflection.Assembly]::LoadFrom(-join($pls,'MySql.Data.DLL'));$ipsd=-join('SUBSTRING_INDEX(REPLACE(IP_SENDER,\\\"fe80::5efe:\\\",\\\"\\\"),\\\"%\\\",1) IN(',$rlp,')');$h1='';$h2='';$rc=-join('recid=','\\\"',$stf.substring(1,1),'\\\"',' LIMIT 1');$rPh='HKCU:\\Software\\INDOMARET\\POS.NET\\Database';$vName='Server';$rgV=Get-ItemProperty -Path $rPh -Name $vName -ErrorAction Stop;$srv=$rgV.$vName;$Cn=New-Object -TypeName MySql.Data.MySqlClient.MySqlConnection;$Cn.ConnectionString=\"\\\"SERVER=$srv;DATABASE='pos';UID='edp';PWD='cUm4l!h4t@datA'\"\\\";$Cn.Open();$cm=New-Object MySql.Data.MySqlClient.MySqlCommand;$at=New-Object MySql.Data.MySqlClient.MySqlDataAdapter;$ds=New-Object System.Data.DataSet;$cm.Connection=$Cn;$cm.CommandTimeout=300;$cm.CommandText=\"\\\"$T $cv($ct($ifn(l.BCA,'$x'),'~',$ifn(l.MDR,'$x') ),CHAR)EDC $f($T($T $ct(v.BON,';',v.BOFF,';',$ifn(v.BST,'$x'),';',($T $ct($ry,':',$j,'(',$d,')') $f $cst $w $ry='NEB' LIMIT 1),'|',$ifn(($T $ct($ry,':',$d,' ',$j) $f $cst $w $ry='PC1' $n $rc),'-'),'|',$ifn(($T $ct($ry,':',$j) $f $cst $w $ry='PCO' $n $rc),'-'),'|',($T $ct($ry,':',a.DESC,' COM',$d) $f $cst a $w $ry='E01' $n $rc))BCA $f($T($T count(*)$f $tdc $w $jdc $k'BCA' $n ($ipsd) $n $de=($T MAX($de) $f $tdc $w $jdc $k'BCA' $n ($ipsd) $n $y($rp)=$y($nw)) $n $ks $k '$ok')BON,($T count(*)$f $tdc $w $jdc $k'BCA' $n ($ipsd) $n $de=($T MAX($de) $f $tdc $w $jdc $k'BCA' $n ($ipsd) $n $y($rp)=$y($nw)) $n $ks $k'$er')BOFF,($T $cv($ct(IF($ks $k '$ok','ONLINE','OFFLINE'),'-',$rp,IF($ks $k '$ok',IF($ks $k '$vir',$ct('-','(ACT VIRTUAL)',$ks),''),$ct('-',$ks))),CHAR) $f($T $ks,$rp $f $tdc $w $jdc $k'bca' $n ($ipsd) $n $y($rp)=$y($nw) $by $rp $dlt 0,1)a)BST)v)BCA,($T $ct(v.MON,';',v.MOFF,';',$ifn(v.MST,'$x'),';',($T $ct($ry,':',$j,'(',$d,')') $f $cst $w $ry ='NEM' LIMIT 1),'|',$ifn(($T $ct($ry,':',$d,'-',$j) $f $cst $w $ry='PC2' $n $rc),'-'),'|',$ifn(($T $ct($ry,':',$j) $f $cst $w $ry='PCO' $n $rc),'-'),'|',($T $cv($ct($ry,':',a.DESC,' COM',$d),CHAR) $f $cst a $w $ry='E02' $n $rc))MDR $f($T($T count(*)$f $tdc $w $jdc $k'$mr'$n ($ipsd) $n $de=($T MAX($de) $f $tdc $w $jdc $k'$mr' $n ($ipsd) $n $y($rp)=$y($nw)) $n $ks $k '$ok')MON,($T count(*)$f $tdc $w $jdc $k'$mr' $n ($ipsd) $n $de=($T MAX($de) $f $tdc $w $jdc $k'$mr' $n ($ipsd) $n $y($rp)=$y($nw))$n $ks $k '$er')MOFF,($T $cv($ct(IF($ks $k'$ok','ONLINE','OFFLINE'),'-',$rp,IF($ks $k '$ok',IF($ks $k '$vir',$ct('-','(ACT VIRTUAL)',$ks),''),$ct('-', $ks))),CHAR)$f ($T $ks,$rp $f $tdc $w $jdc $k'$mr' $n ($ipsd) $n $y($rp)=$y($nw) $by $rp $dlt 0,1)b)MST)v)MDR) l\"\\\";$at.SelectCommand=$cm;$Nm=$at.Fill($ds,'data');foreach($Dts in $ds.tables[0]){$h1=$Dts.EDC}$Cn.Close();$rh=$x+'|'+$x;if($h1.Length -gt 1){$h2=$h1}else{$h2=$rh}return $h2}$ed=G($stf);$al+''+$ed;}}\""}
                        //-- get cpu usage wmic --//
                        //command={"%systemroot%\\System32\\WindowsPowerShell\\v1.0\\powershell.exe \"$mdr='MANDIRI';$er='TIDAK|DITOLAK, ERROR HOST|RESPONSE DARI EDC BLANK|CRC SALAH|tidak terima response|THE DEVICE|A device';$r='Replace';$ifn='IFNULL';$lpc='IP_SENDER IN';$d='DOCNO';$j='JENIS';$ry='RKEY';$cst='CONST';$pls='C:\\IDMCommandListeners\\';$lf='LEFT';$nw='NOW()';$y='YEAR';$rlk='RLIKE';$ct='CONCAT';$n='AND';$ks='response';$dlt='DESC LIMIT';$jdc='jenisedc';$T='SELECT';$w='WHERE';$f='FROM';$cv='CONVERT';$oby='ORDER BY';$x='NOEDC';$rp='responsetime';$tdc='heartbeat_edc';$li='C:\\Windows\\System32\\slmgr.vbs';$sts='';$gs=Get-ChildItem -Path 'env:'|Where-Object{$_.Name -like 'station'};foreach($vr in $gs){if($vr.Value.substring(0,1) -eq 0){$sts=$vr.Value.substring(1,1)}else{$sts=$vr.Value}};$stf=$gs.Value;$lip='';$gp=cmd /r ipconfig|find 'IPv4 Address';$rk=$gp.$r('IPv4 Address','').$r('. ','').$r(':','').$r(' ','').$r(' ',',');if($rk.Length -lt 5){for($v=0;$v -lt $rk.Length;$v++){$lip=''+$lip+','+$rk[$v]};$rlp='\\\"'+$lip.substring(1,$lip.Length-1).Replace(',' , '\\\",\\\"')+'\\\"'}else{$rlp='\\\"'+$rk+'\\\"'}function get(){$ws=(Get-WmiObject Win32_OperatingSystem);$os=$ws.Caption;$ar=$ws.OSArchitecture;$cfo=Get-WmiObject Win32_Processor;$cs=$($cfo.Name);$cTot=Get-WmiObject Win32_Processor|Select LoadPercentage |ft -HideTableHeaders|Out-String;$cpr=$cTot.Trim();$o=Get-WmiObject Win32_OperatingSystem;$pM=[math]::Round(($o.TotalVisibleMemorySize-$o.FreePhysicalMemory)/$o.TotalVisibleMemorySize*100,2);$pn=Get-WmiObject Win32_PhysicalMemory;$tme=($pn|Measure-Object Capacity -Sum).Sum/1GB;$do=Get-WmiObject Win32_DiskDrive;foreach($disk in $do){$hml=$($disk.Model)};$t_cap=0;$t_use=0;$t_free=0;$dvs=Get-WmiObject Win32_LogicalDisk;foreach($drv in $dvs){$cpy=$drv.Size;$frSp=$drv.FreeSpace;$usSp=$cpy-$frSp;$t_cap+=$cpy;$t_use+=$usSp;$t_free+=$frSp};$tcp=$t_cap/1GB;$tse=$t_use/1GB;$tfr=$t_free/1GB;$fl=Get-WmiObject -Namespace rootwmi -Class MSStorageDriver_FailurePredictStatus;$std='';if($fl-ne $null){$std=$fl.PredictFailure|Out-String}else{$std='False'};$cf=Get-PhysicalDisk|Select-Object HealthStatus|-ft -HideTableHeaders|Out-String;$fk='';if(-not([string]::IsNullOrEmpty($cf))){$fk=$cf}else{$f=cmd /r wmic diskdrive get status|Out-String;$fk=$f}$rst=powercfg /q SCHEME_BALANCED SUB_BATTERY;$rss=$rst-split '`n';$lBACI=$null;$cBAAC=$null;for($i=0;$i -lt $rss.Length;$i++){$line=$rss[$i];$lDC='';if($line -like '*Power Setting GUID: d8742dcb-3e6a-4b3c-b3fe-374623cdcf06*'){if($rss[$i+1].tostring() -like '*Alias*'){$line=$rss[$i+10];$lDC=$rss[$i+11]}else{$line=$rss[$i+9];$lDC=$rss[$i+10]};$lBACI=$line.Trim().Split(':')[1].Trim();$lBDCIdx=$lDC.Trim().Split(':')[1].Trim()};if($line -like'*Power Setting GUID: 637ea02f-bbcb-4015-8e2c-a1c7b9c0b546*'){if($rss[$i+1].tostring() -like '*Alias*'){$line=$rss[$i+10];$lDC=$rss[$i+11]}else{$line=$rss[$i+9];$lDC=$rss[$i+10]};$cBACIdx=$line.Trim().Split(':')[1].Trim();$cBIdx=$lDC.Trim().Split(':')[1].Trim()}};function Name($idx){if($idx-eq'0x00000000'){return 'Do nothing'}elseif($idx -eq'0x00000001'){return 'Sleep'}elseif($idx -eq'0x00000002'){return 'Hibernate'}elseif($idx -eq'0x00000003'){return 'Shut down'}else{return 'Unknown'}};$lB1=$(Name $lBACI);$lB2=$(Name $lBDCIdx);$cB1=$(Name $cBACIdx);$cB2=$(Name $cBIdx);$hb1=$false;$hb2=$false;if($lB1 -eq'Hibernate' -or $lB2 -eq'Hibernate'){$hb1=$true};if($cB1 -eq'Hibernate' -or $cB2 -eq'Hibernate') {$hb2=$true};if($hb1 -eq $true -and $hb2 -eq $true){$Hib='OK'}else{$Hib='NOK'};$uo=Get-WmiObject -Class Win32_Battery;if($uo){$sS=': $uo.Status,Status:$uo.BatteryStatus),Level: $($uo.EstimatedChargeRemaining)%'}else{$sS='NOK.'};$nad=Get-WmiObject Win32_NetworkAdapter|Where-Object{$_.AdapterType -eq 'Ethernet 802.3' -and $_.NetConnectionStatus -eq 2};foreach($adr in $nad){$spM=$adr.Speed/1e6;$l=''+$spM+' MB/s'};$rup='';$uo=Get-WmiObject -Class Win32_Battery;if($uo){$sS=$uo.Status;$bs=$uo.BatteryStatus;$bcr=$uo.EstimatedChargeRemaining;$rup=$sS+' '+$bs+' '+$bcr+'%'}else{$rup='NOK'};$ys=Get-WmiObject Win32_OperatingSystem;$lBUT=[System.Management.ManagementDateTimeConverter]::ToDateTime($ys.LastBootUpTime);$upt=(Get-Date)-$lBUT;$sUp=''+$upt.Days+' hari '+$upt.Hours+' jam '+$upt.Minutes+' menit';$Awn=(cscript /Nologo $li /xpr)|Out-String;$lc=(Get-WmiObject -query 'select * FROM SoftwareLicensingService').OA3xOriginalProductKey;$lc2=$dFP=''+$pls+'OS_KeyDLL.dll';if([System.IO.File]::Exists($dFP)){add-type -path $dFP;$dID=[OS_KeyDLL.OS_KeyGet]::GetRegistryDigitalProductId();$lc2=[OS_KeyDLL.OS_KeyGet]::WInnKeyFinder($dID)}else{$lc2='NOK Dll'}$pKy=-join($lc,':',$lc2);$dll=$pls+'LibreHardwareMonitorLib.dll';Add-Type -LiteralPath $dll;$mr=[LibreHardwareMonitor.Hardware.Computer]::new();$mr.IsCPUEnabled=$true;$mr.Open();foreach($ssr in $mr.Hardware.Sensors){if($ssr.SensorType -eq'Temperature' -and $ssr.Name -eq'CPU Package'){$em=$ssr.Value;break}}$mr.Close();$bt=Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Diagnostics-Performance/Operational';Id=100,108,110}-MaxEvents 1|ForEach-Object{$eventXml=([xml]$_.ToXml()).Event;[math]::round(([int64]($eventXml.EventData.Data|Where-Object{$_.Name -eq 'BootTime'}).InnerXml)/1000/60,2)};$hl=''+$os+'~'+$ar+'~'+$cs+'~'+$cpr+'~'+$pM+'~'+$tme+'~'+$hml+'~'+$tcp+'~'+$tse+'~'+$tfr+'~'+$std+'~'+$fk.Trim()+'~'+$Hib+'~'+$rup+'~'+$l+'~'+$sUp+'~'+$Awn.Trim()+'~'+$pKy+'~'+$em+'~'+$bt+'~'+$rlp+'~';return $hl}$all=get;function G($stf){[void][system.reflection.Assembly]::LoadFrom(-join($pls,'MySql.Data.DLL'));$h1='';$h2='';$rc=-join('recid=',$stf.substring(1,1), ' LIMIT 1');$rPath='HKCU:\\Software\\INDOMARET\\POS.NET\\Database';$vName='Server';$rgV=Get-ItemProperty -Path $rPath -Name $vName -ErrorAction Stop;$server=$rgV.$vName;$Con=New-Object -TypeName MySql.Data.MySqlClient.MySqlConnection;$Con.ConnectionString=\"\\\"SERVER=$server;DATABASE='pos';UID='edp';PWD='cUm4l!h4t@datA'\"\\\";$Con.Open();$cm=New-Object MySql.Data.MySqlClient.MySqlCommand;$at=New-Object MySql.Data.MySqlClient.MySqlDataAdapter;$ds=New-Object System.Data.DataSet;$cm.Connection=$Con;$cm.CommandText=\"\\\"$T $cv($ct($ifn(l.HBCA,'$x') ,'~',$ifn(l.HMDR,'$x') ),CHAR)HEDC $f($T($T $ct(v.BON,';',v.BOFF,';',$ifn(v.BLST,'$x'),';',($T $ct($ry,':',$j,'(',$d,')') $f $cst $w $ry='NEB' LIMIT 1),'|',$ifn(($T $ct($ry,':',$d,' ',$j) $f $cst $w $ry='PC1' $n $rc),'-'),'|',$ifn(($T $ct($ry,':',$j) $f $cst $w $ry='PCO' $n $rc),'-'),'|',($T $ct($ry,':',a.DESC,' COM',$d) $f $cst a $w $ry='E01' $n $rc))HBCA $f($T($T count(*)$f $tdc $w $jdc $rlk'BCA' $n $lpc($rlp) $n DATE($rp)=($T MAX(DATE($rp)) $f $tdc $w $jdc $rlk'BCA' $n $lpc($rlp) $n $y($rp)=$y($nw)) $n $lf($ks,2)='OK')BON,($T count(*)$f $tdc $w $jdc $rlk'BCA' $n $lpc($rlp) $n DATE($rp)=($T MAX(DATE($rp)) $f $tdc $w $jdc $rlk'BCA' $n $lpc($rlp) $n $y($rp)=$y($nw)) $n ($ks $rlk '$er' OR ($lf($ks,8)='The port' $n $ks $rlk 'does not exist.')))BOFF,($T $cv($ct(IF($lf($ks,2)='OK','ONLINE','OFFLINE'),'-',$rp,IF($lf($ks,2)='OK','',$ct('-',$ks))),CHAR) $f($T $ks,$rp $f $tdc $w $jdc $rlk'bca' $n $lpc($rlp) $n $y($rp)=$y($nw) $oby $rp $dlt 0,1)a)BLST) v)HBCA,($T $ct(v.MON,';',v.MOFF,';',$ifn(v.MLST,'$x'),';',($T $ct($ry,':',$j,'(',$d,')') $f $cst $w $ry ='NEM' LIMIT 1),'|',$ifn(($T $ct($ry,':',$d,'-',$j) $f $cst $w $ry='PC2' $n $rc),'-'),'|',$ifn(($T $ct($ry,':',$j) $f $cst $w $ry='PCO' $n $rc),'-'),'|',($T $cv($ct($ry,':',a.DESC,' COM',$d),CHAR) $f $cst a $w $ry='E02' $n $rc))HMDR $f($T($T count(*)$f $tdc $w $jdc $rlk'$mdr'$n $lpc($rlp) $n DATE($rp)=($T MAX(DATE($rp)) $f $tdc $w $jdc $rlk'$mdr' $n $lpc($rlp) $n $y($rp)=$y($nw)) $n $lf($ks,7)='|00BANK')MON,($T count(*)$f $tdc $w $jdc $rlk'$mdr' $n $lpc($rlp) $n DATE($rp)=($T MAX(DATE($rp)) $f $tdc $w $jdc $rlk'$mdr' $n $lpc($rlp) $n $y($rp)=$y($nw)) $n ($ks='' OR $ks $rlk '$er') )MOFF,($T $cv($ct(IF($lf($ks,7)='|00BANK','ONLINE','OFFLINE'),'-',$rp,IF($lf($ks,7)='|00BANK','',$ct('-', $ks))),CHAR)$f ($T $ks,$rp $f $tdc $w $jdc $rlk'$mdr' $n $lpc($rlp) $n $y($rp)=$y($nw) $oby $rp $dlt 0,1)b)MLST)v)HMDR) l\"\\\";$at.SelectCommand=$cm;$Num=$at.Fill($ds,'data');foreach($Dts in $ds.tables[0]){$h1=$Dts.HEDC}$Con.Close();$rh=-join($x,'|',$x);if($h1.Length -gt 1){$h2=$h1}else{$h2=$rh}return $h2}$ed=G($stf);$all+''+$ed;\""}
                        //-- get cpu usage average --//
                        //command={"%systemroot%\\System32\\WindowsPowerShell\\v1.0\\powershell.exe \"$mdr='MANDIRI';$er='TIDAK|DITOLAK, ERROR HOST|RESPONSE DARI EDC BLANK|CRC SALAH|tidak terima response|THE DEVICE|A device';$r='Replace';$ifn='IFNULL';$lpc='IP_SENDER IN';$d='DOCNO';$j='JENIS';$ry='RKEY';$cst='CONST';$pls='C:\\IDMCommandListeners\\';$lf='LEFT';$nw='NOW()';$y='YEAR';$rlk='RLIKE';$ct='CONCAT';$n='AND';$ks='response';$dlt='DESC LIMIT';$jdc='jenisedc';$T='SELECT';$w='WHERE';$f='FROM';$cv='CONVERT';$oby='ORDER BY';$x='NOEDC';$rp='responsetime';$tdc='heartbeat_edc';$li='C:\\Windows\\System32\\slmgr.vbs';$sts='';$gs=Get-ChildItem -Path 'env:'|Where-Object{$_.Name -like 'station'};foreach($vr in $gs){if($vr.Value.substring(0,1) -eq 0){$sts=$vr.Value.substring(1,1)}else{$sts=$vr.Value}};$stf=$gs.Value;$lip='';$gp=cmd /r ipconfig|find 'IPv4 Address';$rk=$gp.$r('IPv4 Address','').$r('. ','').$r(':','').$r(' ','').$r(' ',',');if($rk.Length -lt 5){for($v=0;$v -lt $rk.Length;$v++){$lip=''+$lip+','+$rk[$v]};$rlp='\\\"'+$lip.substring(1,$lip.Length-1).Replace(',' , '\\\",\\\"')+'\\\"'}else{$rlp='\\\"'+$rk+'\\\"'}function get(){$ws=(Get-WmiObject Win32_OperatingSystem);$os=$ws.Caption;$ar=$ws.OSArchitecture;$cfo=Get-WmiObject Win32_Processor;$cs=$($cfo.Name);$cpr=Get-WmiObject Win32_Processor|Measure-Object -Property LoadPercentage -Average|Select Average|ft -HideTableHeaders|Out-String;$o=Get-WmiObject Win32_OperatingSystem;$pM=[math]::Round(($o.TotalVisibleMemorySize-$o.FreePhysicalMemory)/$o.TotalVisibleMemorySize*100,2);$pn=Get-WmiObject Win32_PhysicalMemory;$tme=($pn|Measure-Object Capacity -Sum).Sum/1GB;$do=Get-WmiObject Win32_DiskDrive;foreach($disk in $do){$hml=$($disk.Model)};$t_cap=0;$t_use=0;$t_free=0;$dvs=Get-WmiObject Win32_LogicalDisk;foreach($drv in $dvs){$cpy=$drv.Size;$frSp=$drv.FreeSpace;$usSp=$cpy-$frSp;$t_cap+=$cpy;$t_use+=$usSp;$t_free+=$frSp};$tcp=$t_cap/1GB;$tse=$t_use/1GB;$tfr=$t_free/1GB;$fl=Get-WmiObject -Namespace rootwmi -Class MSStorageDriver_FailurePredictStatus;$std='';if($fl-ne $null){$std=$fl.PredictFailure|Out-String}else{$std='False'};$cf=Get-PhysicalDisk|Select-Object HealthStatus|-ft -HideTableHeaders|Out-String;$fk='';if(-not([string]::IsNullOrEmpty($cf))){$fk=$cf}else{$f=cmd /r wmic diskdrive get status|Out-String;$fk=$f}$rst=powercfg /q SCHEME_BALANCED SUB_BATTERY;$rss=$rst-split '`n';$lBACI=$null;$cBAAC=$null;for($i=0;$i -lt $rss.Length;$i++){$line=$rss[$i];$lDC='';if($line -like '*Power Setting GUID: d8742dcb-3e6a-4b3c-b3fe-374623cdcf06*'){if($rss[$i+1].tostring() -like '*Alias*'){$line=$rss[$i+10];$lDC=$rss[$i+11]}else{$line=$rss[$i+9];$lDC=$rss[$i+10]};$lBACI=$line.Trim().Split(':')[1].Trim();$lBDCIdx=$lDC.Trim().Split(':')[1].Trim()};if($line -like'*Power Setting GUID: 637ea02f-bbcb-4015-8e2c-a1c7b9c0b546*'){if($rss[$i+1].tostring() -like '*Alias*'){$line=$rss[$i+10];$lDC=$rss[$i+11]}else{$line=$rss[$i+9];$lDC=$rss[$i+10]};$cBACIdx=$line.Trim().Split(':')[1].Trim();$cBIdx=$lDC.Trim().Split(':')[1].Trim()}};function Name($idx){if($idx-eq'0x00000000'){return 'Do nothing'}elseif($idx -eq'0x00000001'){return 'Sleep'}elseif($idx -eq'0x00000002'){return 'Hibernate'}elseif($idx -eq'0x00000003'){return 'Shut down'}else{return 'Unknown'}};$lB1=$(Name $lBACI);$lB2=$(Name $lBDCIdx);$cB1=$(Name $cBACIdx);$cB2=$(Name $cBIdx);$hb1=$false;$hb2=$false;if($lB1 -eq'Hibernate' -or $lB2 -eq'Hibernate'){$hb1=$true};if($cB1 -eq'Hibernate' -or $cB2 -eq'Hibernate') {$hb2=$true};if($hb1 -eq $true -and $hb2 -eq $true){$Hib='OK'}else{$Hib='NOK'};$uo=Get-WmiObject -Class Win32_Battery;if($uo){$sS=': $uo.Status,Status:$uo.BatteryStatus),Level: $($uo.EstimatedChargeRemaining)%'}else{$sS='NOK.'};$nad=Get-WmiObject Win32_NetworkAdapter|Where-Object{$_.AdapterType -eq 'Ethernet 802.3' -and $_.NetConnectionStatus -eq 2};foreach($adr in $nad){$spM=$adr.Speed/1e6;$l=''+$spM+' MB/s'};$rup='';$uo=Get-WmiObject -Class Win32_Battery;if($uo){$sS=$uo.Status;$bs=$uo.BatteryStatus;$bcr=$uo.EstimatedChargeRemaining;$rup=$sS+' '+$bs+' '+$bcr+'%'}else{$rup='NOK'};$ys=Get-WmiObject Win32_OperatingSystem;$lBUT=[System.Management.ManagementDateTimeConverter]::ToDateTime($ys.LastBootUpTime);$upt=(Get-Date)-$lBUT;$sUp=''+$upt.Days+' hari '+$upt.Hours+' jam '+$upt.Minutes+' menit';$Awn=(cscript /Nologo $li /xpr)|Out-String;$lc=(Get-WmiObject -query 'select * FROM SoftwareLicensingService').OA3xOriginalProductKey;$lc2=$dFP=''+$pls+'OS_KeyDLL.dll';if([System.IO.File]::Exists($dFP)){add-type -path $dFP;$dID=[OS_KeyDLL.OS_KeyGet]::GetRegistryDigitalProductId();$lc2=[OS_KeyDLL.OS_KeyGet]::WInnKeyFinder($dID)}else{$lc2='NOK Dll'}$pKy=-join($lc,':',$lc2);$dll=$pls+'LibreHardwareMonitorLib.dll';Add-Type -LiteralPath $dll;$mr=[LibreHardwareMonitor.Hardware.Computer]::new();$mr.IsCPUEnabled=$true;$mr.Open();foreach($ssr in $mr.Hardware.Sensors){if($ssr.SensorType -eq'Temperature' -and $ssr.Name -eq'CPU Package'){$em=$ssr.Value;break}}$mr.Close();$bt=Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Diagnostics-Performance/Operational';Id=100,108,110}-MaxEvents 1|ForEach-Object{$eventXml=([xml]$_.ToXml()).Event;[math]::round(([int64]($eventXml.EventData.Data|Where-Object{$_.Name -eq 'BootTime'}).InnerXml)/1000/60,2)};$hl=''+$os+'~'+$ar+'~'+$cs+'~'+$cpr.Trim()+'~'+$pM+'~'+$tme+'~'+$hml+'~'+$tcp+'~'+$tse+'~'+$tfr+'~'+$std+'~'+$fk.Trim()+'~'+$Hib+'~'+$rup+'~'+$l+'~'+$sUp+'~'+$Awn.Trim()+'~'+$pKy+'~'+$em+'~'+$bt+'~'+$rlp+'~';return $hl}$all=get;function G($stf){[void][system.reflection.Assembly]::LoadFrom(-join($pls,'MySql.Data.DLL'));$h1='';$h2='';$rc=-join('recid=',$stf.substring(1,1), ' LIMIT 1');$rPath='HKCU:\\Software\\INDOMARET\\POS.NET\\Database';$vName='Server';$rgV=Get-ItemProperty -Path $rPath -Name $vName -ErrorAction Stop;$server=$rgV.$vName;$Con=New-Object -TypeName MySql.Data.MySqlClient.MySqlConnection;$Con.ConnectionString=\"\\\"SERVER=$server;DATABASE='pos';UID='edp';PWD='cUm4l!h4t@datA'\"\\\";$Con.Open();$cm=New-Object MySql.Data.MySqlClient.MySqlCommand;$at=New-Object MySql.Data.MySqlClient.MySqlDataAdapter;$ds=New-Object System.Data.DataSet;$cm.Connection=$Con;$cm.CommandText=\"\\\"$T $cv($ct($ifn(l.HBCA,'$x') ,'~',$ifn(l.HMDR,'$x') ),CHAR)HEDC $f($T($T $ct(v.BON,';',v.BOFF,';',$ifn(v.BLST,'$x'),';',($T $ct($ry,':',$j,'(',$d,')') $f $cst $w $ry='NEB' LIMIT 1),'|',$ifn(($T $ct($ry,':',$d,' ',$j) $f $cst $w $ry='PC1' $n $rc),'-'),'|',$ifn(($T $ct($ry,':',$j) $f $cst $w $ry='PCO' $n $rc),'-'),'|',($T $ct($ry,':',a.DESC,' COM',$d) $f $cst a $w $ry='E01' $n $rc))HBCA $f($T($T count(*)$f $tdc $w $jdc $rlk'BCA' $n $lpc($rlp) $n DATE($rp)=($T MAX(DATE($rp)) $f $tdc $w $jdc $rlk'BCA' $n $lpc($rlp) $n $y($rp)=$y($nw)) $n $lf($ks,2)='OK')BON,($T count(*)$f $tdc $w $jdc $rlk'BCA' $n $lpc($rlp) $n DATE($rp)=($T MAX(DATE($rp)) $f $tdc $w $jdc $rlk'BCA' $n $lpc($rlp) $n $y($rp)=$y($nw)) $n ($ks $rlk '$er' OR ($lf($ks,8)='The port' $n $ks $rlk 'does not exist.')))BOFF,($T $cv($ct(IF($lf($ks,2)='OK','ONLINE','OFFLINE'),'-',$rp,IF($lf($ks,2)='OK','',$ct('-',$ks))),CHAR) $f($T $ks,$rp $f $tdc $w $jdc $rlk'bca' $n $lpc($rlp) $n $y($rp)=$y($nw) $oby $rp $dlt 0,1)a)BLST) v)HBCA,($T $ct(v.MON,';',v.MOFF,';',$ifn(v.MLST,'$x'),';',($T $ct($ry,':',$j,'(',$d,')') $f $cst $w $ry ='NEM' LIMIT 1),'|',$ifn(($T $ct($ry,':',$d,'-',$j) $f $cst $w $ry='PC2' $n $rc),'-'),'|',$ifn(($T $ct($ry,':',$j) $f $cst $w $ry='PCO' $n $rc),'-'),'|',($T $cv($ct($ry,':',a.DESC,' COM',$d),CHAR) $f $cst a $w $ry='E02' $n $rc))HMDR $f($T($T count(*)$f $tdc $w $jdc $rlk'$mdr'$n $lpc($rlp) $n DATE($rp)=($T MAX(DATE($rp)) $f $tdc $w $jdc $rlk'$mdr' $n $lpc($rlp) $n $y($rp)=$y($nw)) $n $lf($ks,7)='|00BANK')MON,($T count(*)$f $tdc $w $jdc $rlk'$mdr' $n $lpc($rlp) $n DATE($rp)=($T MAX(DATE($rp)) $f $tdc $w $jdc $rlk'$mdr' $n $lpc($rlp) $n $y($rp)=$y($nw)) $n ($ks='' OR $ks $rlk '$er'))MOFF,($T $cv($ct(IF($lf($ks,7)='|00BANK','ONLINE','OFFLINE'),'-',$rp,IF($lf($ks,7)='|00BANK','',$ct('-', $ks))),CHAR)$f ($T $ks,$rp $f $tdc $w $jdc $rlk'$mdr' $n $lpc($rlp) $n $y($rp)=$y($nw) $oby $rp $dlt 0,1)b)MLST)v)HMDR) l\"\\\";$at.SelectCommand=$cm;$Num=$at.Fill($ds,'data');foreach($Dts in $ds.tables[0]){$h1=$Dts.HEDC}$Con.Close();$rh=-join($x,'|',$x);if($h1.Length -gt 1){$h2=$h1}else{$h2=$rh}return $h2}$ed=G($stf);$all+''+$ed;\""}
                        IDReport={"Report Service Excellent"}  
            />
        </>
    )
}
export default Service_Excelent;